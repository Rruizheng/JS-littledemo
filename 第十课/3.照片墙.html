<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title></title>
		<style>
			body,div,ul,li,h2{margin: 0;padding: 0;}
			body{font: 12px/1.5 arial;}
			ul{list-style-type: none;}
			.box{width:860px;height: 891px;border: 1px solid #999;margin: 10px auto;background: #eee;overflow: hidden;}
			.title{height: 30px;border-bottom: 1px solid #999;line-height: 30px;background:#fafafa url(img/ico.gif) no-repeat 5px 50%;padding: 0 15px 0 35px;}
			.title span{font-size: 14px;float: left;}
			.title a{font-size: 14px;float: right;}
			.title a:hover{color: red;}
			.box ul{padding: 5px;}
			
			.box li{width:150px;height: 150px;float: left;padding: 4px;border: 1px solid #999;margin: 5px;background: #fff;display: inline;}
			.box li.hig{border:2px dashed red;padding: 3px;opacity:0.5;filter:alpha(opacity=50);}
			img{float:left;width: 150px;height:150px;}
			
		</style>
	</head>
	<body>
		<div class="box">
			<h2 class="title">
				<span>
					照片墙
				</span>
				<a href="">随机排列</a>
			</h2>
			<ul>
	
			</ul>
		</div>
		<div class="box">
			<h2 class="title">
				<span>
					照片墙
				</span>
				<a href="">随机排列</a>
			</h2>
			<ul>
			</ul>
		</div>
		<script>
			//获取ID
			var $ = function(id){
				return typeof id === "string" ? document.getElementById(id) : id;
			}
			
			//获取TagName
			var $$ = function(tagName,oParent){
				return (oParent || document).getElementsByTagName(tagName);
			}
			
			//获取className
			var $$$ = function(sClass,oParent){
				var aClass = [];
				var i = 0;
				var reClass = new RegExp("(\\s|^)"+sClass+"($|\\s)");
				var aElement = $$("*",oParent);
				
				for(i=0;i<aElement.length;i++){
					reClass.test(aElement[i].className) && aClass.push(aElement[i]);
				}
				return aClass;
			}
			
			//获取元素位置
			function getPos(obj){
				var iTop = obj.offsetTop;
				var iLeft = obj.offsetLeft;
				while(obj.offsetParent){
					iTop += obj.offsetParent.offsetTop;
					iLeft +=obj.offsetParent.offsetLeft;
					obj = obj.offsetParent;
				}
				return {top:iTop,left:iLeft}
			}
			
			//插入照片墙
			var PhotoWall = function(){
				this.initialize.apply(this,arguments);
			}
			PhotoWall.prototype = {
				initialize:function(obj,aData){
					var oThis = this;//this == PhotoWall
					this.oParent = $(obj);//div.box;
					this.oUl = $$("ul",this.oParent)[0];//this.oParent==div.box
					this.oBtn = $$("a",this.oParent)[0];
					this.zIndex = 1;
					this.aPos =[];
					this.aData = aData;
					this.dom = document.documentElement || document.body;
					this.create();
					this.oBtn.onclick = function () {oThis.randomOrder()}
				},
				create:function(){
					var aFrag = document.createDocumentFragment();
					var i = 0;
					for(i=0;i<this.aData.length;i++){
						var oLi = document.createElement("li");
						var oImg = document.createElement("img");
						oImg.src = this.aData[i];
						oLi.appendChild(oImg);
						aFrag.appendChild(oLi);
					}
					this.oUl.appendChild(aFrag);//this==photoWall;
					this.aLi = $$("li",this.oParent);//为什么是aBox[].oParent?
					this.changeLayout();
				},
				changeLayout: function(){
					var i=0;
					this.oParent.style.height = this.oParent.offsetHeight - 2 + "px";//定义height的时候不考虑border,但是在取offsetHeight的时候是加了border的，所以要减掉
					this.aPos.length = 0;//aPos用来存储位置的顺序参数；
					for(var i=0;i<this.aLi.length;i++){
						this.aLi[i].className = "";
					}
					//按顺序把每个Li原始的位置保存下来，并且作为top,left参数赋值给原来的对象，存在aPos里面；
					for(var i=0;i<this.aLi.length;i++){
						this.aLi[i].index = 1;
						this.aLi[i].style.top = getPos(this.aLi[i]).top + "px";
						this.aLi[i].style.left = getPos(this.aLi[i]).left + "px";
						this.aPos.push({left:getPos(this.aLi[i]).left,top:getPos(this.aLi[i]).top});
					}
					//把每个Li都设置成absolute,然后调用drag
					for(var i=0;i<this.aLi.length;i++){
						this.aLi[i].style.position = "absolute";
						this.aLi[i].style.margin = "0";
						this.drag(this.aLi[i]);
					}
				},
				drag:function(obj,handler){
					
				},
				doMove:function(obj,target,callback){
					var oThis = this;//this==photoWall;
					clearInterval(obj.timer);
					obj.timer = setInterval(function(){
						var iCurL = getPos(obj).left;
						var iCurT = getPos(obj).top;
						var iSpeedL = (target.left - iCurL)/5;
						var iSpeedT = (target.top - iCurT)/5;
						iSpeedT = iSpeedT > 0 ? Math.ceil(iSpeedT) : Math.floor(iSpeedT);
						iSpeedL = iSpeedL > 0 ? Math.ceil(iSpeedL) : Math.floor(iSpeedL);
						(iCurL == target.left&&iCurT == target.top) ? (clearInterval(obj.timer),callback&&callback()) : (obj.style.left = iCurL + iSpeedL + "px",obj.style.top = iCurT + iSpeedT + "px")
						},30);
				},
				findNearest:function(obj){
					
				},
				getDistance: function(obj1,Obj2){
					
				},
				isButt:{},
				randomOrder:{}
			}
			window.onload = function(){
				var aBox = $$$("box");
				var aData = [];
				var aExample = [];
				
				for(var i=0;i<25;i++){
					aData[aData.length]="img/zyx/"+i+".jpg";
				}
				
				for(var i=0;i<aBox.length;i++){
					var oExample = new PhotoWall(aBox[i],aData);//创建了PhotoWall对象，也就是this。this.oParent == div.box
					aExample.push(oExample);
				}
				this.onresize = function(){
					for(var p in aExample) aExample[p].changeLayout();
				}
				this.onresize();
			}
			
			
		</script>
	</body>
</html>
